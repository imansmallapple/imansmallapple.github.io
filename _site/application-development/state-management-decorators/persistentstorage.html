<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav ul li a { background-image: none; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>PersistentStorage | Oniro</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="PersistentStorage" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/application-development/state-management-decorators/persistentstorage.html" /> <meta property="og:url" content="http://localhost:4000/application-development/state-management-decorators/persistentstorage.html" /> <meta property="og:site_name" content="Oniro" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="PersistentStorage" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"PersistentStorage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/introduction-to-oniro/images/ONIRO-Masterbrand-horizontal.png"}},"url":"http://localhost:4000/application-development/state-management-decorators/persistentstorage.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> <div class="site-logo" role="img" aria-label="Oniro"></div> </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Eclipse Oniro Project category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/" class="nav-list-link">Eclipse Oniro Project</a><ul class="nav-list"><li class="nav-list-item"><a href="/introduction-to-oniro/introduction-to-oniro.html" class="nav-list-link">Introduction to Oniro</a></li><li class="nav-list-item"><a href="/introduction-to-oniro/oniro-architecture.html" class="nav-list-link">Oniro Architecture</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Application Development category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/application-development/" class="nav-list-link">Application Development</a><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Environment Setup Guide category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/application-development/environment-setup-config/" class="nav-list-link">Environment Setup Guide</a><ul class="nav-list"><li class="nav-list-item"> <a href="/application-development/environment-setup-config/system-requirement.html" class="nav-list-link">System Requirement</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/ide-installation.html" class="nav-list-link">IDE Installation</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/env-config.html" class="nav-list-link">Environment Configuration</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/full-public-sdk.html" class="nav-list-link">Full SDK & Public SDK</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/developer-account.html" class="nav-list-link">Developer Account</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/ohpm.html" class="nav-list-link">Introduction to OHPM</a> </li><li class="nav-list-item"> <a href="/application-development/environment-setup-config/common-issue.html" class="nav-list-link">Common Issues and Solutions</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Create Your First Eclipse Oniro Application category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/application-development/create-first-eclipse-oniro-app/" class="nav-list-link">Create Your First Eclipse Oniro Application</a><ul class="nav-list"><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/create-template.html" class="nav-list-link">Create an Eclipse Oniro app using OpenHarmony Template</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/find-project-files.html" class="nav-list-link">Find project files</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/use-previewer.html" class="nav-list-link">Usage of Previewer</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/build-first-page.html" class="nav-list-link">Build the First Page</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/build-second-page.html" class="nav-list-link">Build the Second Page</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/page-redirect.html" class="nav-list-link">Implementing Page Redirection</a> </li><li class="nav-list-item"> <a href="/application-development/create-first-eclipse-oniro-app/run-real-device.html" class="nav-list-link">Running the Application on a Real Device</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Basic Concepts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/application-development/basic-concepts/" class="nav-list-link">Basic Concepts</a><ul class="nav-list"><li class="nav-list-item"> <a href="/application-development/basic-concepts/app-pack-structure.html" class="nav-list-link">Application Package Structure in Stage Model</a> </li><li class="nav-list-item"> <a href="/application-development/basic-concepts/introduction-to-arkts.html" class="nav-list-link">Introduction to ArkTS</a> </li><li class="nav-list-item"> <a href="/application-development/basic-concepts/arkui-introduction.html" class="nav-list-link">Introduction to ArkUI</a> </li><li class="nav-list-item"> <a href="/application-development/basic-concepts/uiability-and-component.html" class="nav-list-link">UIAbility and Component</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Resource Categories and Access category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/application-development/resource-categories-and-access/" class="nav-list-link">Resource Categories and Access</a><ul class="nav-list"></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Device Development category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/device-development/" class="nav-list-link">Device Development</a><ul class="nav-list"><li class="nav-list-item"><a href="/device-development/quick-build-with-oniro.html" class="nav-list-link">Building Oniro</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Oniro IDE category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/device-development/oniro-ide/" class="nav-list-link">Oniro IDE</a><ul class="nav-list"><li class="nav-list-item"> <a href="/device-development/oniro-ide/getting-started.html" class="nav-list-link">Getting Started</a> </li><li class="nav-list-item"> <a href="/device-development/oniro-ide/code-editing.html" class="nav-list-link">Code Editing</a> </li><li class="nav-list-item"> <a href="/device-development/oniro-ide/user-interface.html" class="nav-list-link">User Interface</a> </li><li class="nav-list-item"> <a href="/device-development/oniro-ide/code-navigation.html" class="nav-list-link">Code Navigation</a> </li><li class="nav-list-item"> <a href="/device-development/oniro-ide/refacting.html" class="nav-list-link">Refactoring</a> </li><li class="nav-list-item"> <a href="/device-development/oniro-ide/language-support.html" class="nav-list-link">Language Support</a> </li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Supported Devices category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/device-development/supported-device/" class="nav-list-link">Supported Devices</a><ul class="nav-list"><li class="nav-list-item"> <a href="/device-development/supported-device/boards/" class="nav-list-link">boards</a> </li><li class="nav-list-item"> <a href="/device-development/supported-device/virtual-machine/" class="nav-list-link">virtual machine</a> </li></ul></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Policies and Compliance category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/policies-and-compliance/" class="nav-list-link">Policies and Compliance</a><ul class="nav-list"></ul></li><li class="nav-list-item"><a href="/community/" class="nav-list-link">Community</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Oniro" aria-label="Search Oniro" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Introduction to ArkTS</a></li> <li class="breadcrumb-nav-list-item"><span>PersistentStorage</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="persistentstorage"> <a href="#persistentstorage" class="anchor-heading" aria-labelledby="persistentstorage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> PersistentStorage </h1> <p>During application development, you may want selected attributes to persist even when the application is closed. In this case, you’ll need PersistentStorage.</p> <p>PersistentStorage is an optional singleton object within an application. Its purpose is to persist selected AppStorage attributes so that their values are the same upon application re-start as they were when the application was closed.</p> <h2 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h2> <p>PersistentStorage retains the selected AppStorage attributes on the device. The application uses the API to determine which AppStorage attributes should be persisted with PersistentStorage. The UI and business logic do not directly access attributes in PersistentStorage. All attribute access is to AppStorage. Changes in AppStorage are automatically synchronized to PersistentStorage.</p> <p>PersistentStorage creates a two-way synchronization with attributes in AppStorage. A frequently used API function is to access AppStorage through PersistentStorage. Additional API functions include managing persisted attributes. The business logic always obtains or sets attributes through AppStorage.</p> <h2 id="constraints"> <a href="#constraints" class="anchor-heading" aria-labelledby="constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Constraints </h2> <p>PersistentStorage accepts the following types and values:</p> <ul> <li>Primitive types such as number, string, boolean, and enum.</li> <li>Objects that can be reconstructed by <strong>JSON.stringify()</strong> and <strong>JSON.parse()</strong>. In other words, built-in types such as Date, Map, and Set, as well as object attribute methods, are not supported.</li> </ul> <p>PersistentStorage does not accept the following types and values:</p> <ul> <li>Nested objects (object arrays and object attributes), because the framework cannot detect the value changes of nested objects (including arrays) in AppStorage.</li> <li><strong>undefined</strong> and <strong>null</strong>.</li> </ul> <p>Data persistence is an operation that takes time. Applications should avoid the following situations:</p> <ul> <li> <p>Persistence of large data sets</p> </li> <li> <p>Persistence of variables that change frequently</p> </li> </ul> <p>It is recommended that the persistent variables of PersistentStorage be less than 2 KB. As PersistentStorage flushes data synchronously, a large amount of persistent data may result in simultaneous time-consuming read and write operations in the UI thread, affecting UI rendering performance. If you need to store a large amount of data, consider using the database API.</p> <p>PersistentStorage is associated with UI instances. Data persistence can succeed only when a UI instance has been initialized (that is, when the callback passed in by <code class="language-plaintext highlighter-rouge">loadContent</code> is called).</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// EntryAbility.ets</span>
<span class="nf">onWindowStageCreate</span><span class="p">(</span><span class="nx">windowStage</span><span class="p">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">WindowStage</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="nx">windowStage</span><span class="p">.</span><span class="nf">loadContent</span><span class="p">(</span><span class="dl">'</span><span class="s1">pages/Index</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">PersistentStorage</span><span class="p">.</span><span class="nf">persistProp</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">47</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <h2 id="use-scenarios"> <a href="#use-scenarios" class="anchor-heading" aria-labelledby="use-scenarios"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Use Scenarios </h2> <h3 id="accessing-persistentstorage-initialized-attribute-from-appstorage"> <a href="#accessing-persistentstorage-initialized-attribute-from-appstorage" class="anchor-heading" aria-labelledby="accessing-persistentstorage-initialized-attribute-from-appstorage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Accessing PersistentStorage Initialized Attribute from AppStorage </h3> <ol> <li> <p>Initialize the PersistentStorage instance.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PersistentStorage</span><span class="p">.</span><span class="nf">persistProp</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">47</span><span class="p">);</span>
</code></pre></div> </div> </li> <li> <p>Obtain the corresponding attribute from AppStorage.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">AppStorage</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="kr">number</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// returns 47</span>
</code></pre></div> </div> <p>Alternatively, apply local definition within the component:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">StorageLink</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">)</span> <span class="nx">aProp</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">48</span><span class="p">;</span>
</code></pre></div> </div> </li> </ol> <p>The complete code is as follows:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PersistentStorage</span><span class="p">.</span><span class="nf">persistProp</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">47</span><span class="p">);</span>

<span class="p">@</span><span class="nd">Entry</span>
<span class="p">@</span><span class="nd">Component</span>
<span class="nx">struct</span> <span class="nx">Index</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">State</span> <span class="nx">message</span><span class="p">:</span> <span class="kr">string</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span>
  <span class="p">@</span><span class="nd">StorageLink</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">)</span> <span class="nx">aProp</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">48</span>

  <span class="nf">build</span><span class="p">()</span> <span class="p">{</span>
    <span class="nc">Row</span><span class="p">()</span> <span class="p">{</span>
      <span class="nc">Column</span><span class="p">()</span> <span class="p">{</span>
        <span class="nc">Text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
        <span class="c1">// The current result is saved when the application exits. After the restart, the last saved result is displayed.</span>
        <span class="nc">Text</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">aProp</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
          <span class="p">.</span><span class="nf">onClick</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">aProp</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="p">})</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <ul> <li>First running after fresh application installation: <ol> <li><strong>persistProp</strong> is called to initialize PersistentStorage. A search for the <strong>aProp</strong> attribute in PersistentStorage returns no result, because the application has just been installed.</li> <li>A search for the attribute <strong>aProp</strong> in AppStorage still returns no result.</li> <li>Create the <strong>aProp</strong> attribute of the number type in AppStorge and initialize it with the value 47.</li> <li>PersistentStorage writes the <strong>aProp</strong> attribute and its value <strong>47</strong> to the local device. The value of <strong>aProp</strong> in AppStorage and its subsequent changes are persisted.</li> <li>In the <strong>&lt;Index&gt;</strong> component, create the state variable <strong>@StorageLink(‘aProp’) aProp</strong>, which creates a two-way synchronization with the <strong>aProp</strong> attribute in AppStorage. During the creation, the search in AppStorage for the <strong>aProp</strong> attribute is successful, and therefore, the state variable is initialized with the value <strong>47</strong> found in AppStorage.</li> </ol> </li> <li>After a click event is triggered: <ol> <li>The state variable <strong>@StorageLink(‘aProp’) aProp</strong> is updated, triggering the <strong>&lt;Text&gt;</strong> component to be re-rendered.</li> <li>The two-way synchronization between the @StorageLink decorated variable and AppStorage results in the change of the <strong>@StorageLink(‘aProp’) aProp</strong> being synchronized back to AppStorage.</li> <li>The change of the <strong>aProp</strong> attribute in AppStorage triggers any other one-way or two-way bound variables to be updated. (In this example, there are no such other variables.)</li> <li>Because the attribute corresponding to <strong>aProp</strong> has been persisted, the change of the <strong>aProp</strong> attribute in AppStorage triggers PersistentStorage to write the attribute and its new value to the device.</li> </ol> </li> <li>Subsequent application running: <ol> <li><strong>PersistentStorage.persistProp(‘aProp’, 47)</strong> is called. A search for the <strong>aProp</strong> attribute in PersistentStorage succeeds.</li> <li>The attribute is added to AppStorage with the value found in PersistentStorage.</li> <li>In the <strong>&lt;Index&gt;</strong> component, the value of the @StorageLink decorated <strong>aProp</strong> attribute is the value written by PersistentStorage to AppStorage, that is, the value stored when the application was closed last time.</li> </ol> </li> </ul> <h3 id="accessing-an-attribute-in-appstorage-before-persistentstorage"> <a href="#accessing-an-attribute-in-appstorage-before-persistentstorage" class="anchor-heading" aria-labelledby="accessing-an-attribute-in-appstorage-before-persistentstorage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Accessing an Attribute in AppStorage Before PersistentStorage </h3> <p>This example is an incorrect use. It is incorrect to use the API to access the attributes in AppStorage before calling <strong>PersistentStorage.persistProp</strong> or <strong>persistProps</strong>, because such a call sequence will result in loss of the attribute values used in the previous application run:</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">aProp</span> <span class="o">=</span> <span class="nx">AppStorage</span><span class="p">.</span><span class="nf">setOrCreate</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">47</span><span class="p">);</span>
<span class="nx">PersistentStorage</span><span class="p">.</span><span class="nf">persistProp</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">48</span><span class="p">);</span>
</code></pre></div></div> <p><strong>AppStorage.setOrCreate(‘aProp’, 47)</strong>: The <strong>aProp</strong> attribute of the number type is created in AppStorage, and its value is set to the specified default value <strong>47</strong>. <strong>aProp</strong> is a persisted attribute. Therefore, it is written back to PersistentStorage, and the value stored in PersistentStorage from the previous run is lost.</p> <p>PersistentStorage.persistProp(‘aProp’, 48): An attribute with the name <strong>aProp</strong> and value <strong>47</strong> – set through the API in AppStorage – is found in PersistentStorage.</p> <h3 id="accessing-an-attribute-in-appstorage-after-persistentstorage"> <a href="#accessing-an-attribute-in-appstorage-after-persistentstorage" class="anchor-heading" aria-labelledby="accessing-an-attribute-in-appstorage-after-persistentstorage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Accessing an Attribute in AppStorage After PersistentStorage </h3> <p>If you do not want to overwrite the values saved in PersistentStorage during the previous application run, make sure any access to attributes in AppStorage is made after a call to a PersistentStorage API.</p> <div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">PersistentStorage</span><span class="p">.</span><span class="nf">persistProp</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span> <span class="mi">48</span><span class="p">);</span>
<span class="k">if </span><span class="p">(</span><span class="nx">AppStorage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// If the value stored in PersistentStorage exceeds 50, set the value to 47.</span>
    <span class="nx">AppStorage</span><span class="p">.</span><span class="nf">setOrCreate</span><span class="p">(</span><span class="dl">'</span><span class="s1">aProp</span><span class="dl">'</span><span class="p">,</span><span class="mi">47</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>After reading the data stored in PersistentStorage, the sample code checks whether the value of <strong>aProp</strong> is greater than 50 and, if it is, sets <strong>aProp</strong> to <strong>47</strong> through an API in AppStorage.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
